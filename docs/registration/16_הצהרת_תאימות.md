# הצהרת תאימות — Compliance Declaration

## 1. פרטי התוכנה

| פרט | ערך |
|------|------|
| שם התוכנה | LogiRoute |
| סוג | מערכת ניהול לוגיסטיקה ומסמכים חשבונאיים |
| פלטפורמה | Web (Flutter), Android, iOS |
| ארכיטקטורה | SaaS — Cloud-based (Google Firebase) |
| אזור אחסון | me-west1 (תל אביב, ישראל) |

## 2. תאימות לדרישות חוק

### 2.1 הוראות ניהול ספרים (תקנות ניהול פנקסי חשבונות)

| דרישה | סטטוס | מימוש |
|--------|--------|--------|
| מספור רץ רציף | ✅ | Transaction אטומי + Rules increment==1 |
| סדרות נפרדות לכל סוג מסמך | ✅ | counter per documentType |
| איסור מחיקת מסמכים | ✅ | `allow delete: if false` |
| איסור שינוי מסמך שעבר סיום | ✅ | 19 protected fields ב-Rules |
| יומן ביקורת | ✅ | append-only auditLog subcollection |
| שמירה 7 שנים | ✅ | retention policy + automated checks |
| גיבוי תקופתי | ✅ | quarterly + daily + PITR |
| בדיקת שחזור | ✅ | quarterly restore tests |

### 2.2 מסמכים ממוחשבים

| דרישה | סטטוס | מימוש |
|--------|--------|--------|
| חתימת שלמות (hash) | ✅ | SHA-256 על כל שדות מוגנים + סכומים |
| שרשרת שלמות | ✅ | hash-chain + external anchors |
| הדפסת מקור — עותק אחד בלבד | ✅ | originalPrinted flag + auto-redirect |
| סימון הדפסה חוזרת | ✅ | תאריך + שעה על המסמך |
| סימון טיוטה | ✅ | "טיוטה — לא לשימוש רשמי" |
| קובץ במבנה אחיד | ✅ | CSV export + metadata |

### 2.3 חשבוניות ישראל (מספר הקצאה)

| דרישה | סטטוס | מימוש |
|--------|--------|--------|
| סף 20,000₪ (2025) | ✅ | threshold per date |
| סף 10,000₪ (01.01.2026) | ✅ | threshold per date |
| סף 5,000₪ (01.06.2026) | ✅ | threshold per date |
| בקשה אוטומטית לאחר סיום | ✅ | auto at finalize |
| חסימת מקור ללא הקצאה | ✅ | canPrintOriginal check |
| retry + exponential backoff | ✅ | 3 attempts, 2s/4s/8s |
| idempotency key | ✅ | requestId header |
| manual retry | ✅ | UI button |

### 2.4 אבטחת מידע

| דרישה | סטטוס | מימוש |
|--------|--------|--------|
| הצפנה at-rest | ✅ | AES-256 (Google managed) |
| הצפנה in-transit | ✅ | TLS 1.2+ (HTTPS) |
| הפרדת דיירים | ✅ | companies/{companyId}/... + Rules |
| RBAC | ✅ | 5 roles, least privilege |
| יומן גישה | ✅ | append-only access_log |
| אימות משתמשים | ✅ | Firebase Auth |

### 2.5 SaaS — דרישות נוספות

| דרישה | סטטוס | מימוש |
|--------|--------|--------|
| Tenant isolation | ✅ | subcollections + Rules |
| Data residency (ישראל) | ✅ | me-west1 |
| Backup per tenant | ✅ | company-level backup records |
| Access log per tenant | ✅ | company-level access_log |
| Export per tenant | ✅ | company-level uniform export |

## 3. אכיפה

### 3.1 צד שרת (Firestore Security Rules)
- אי-שינוי: field-level immutability enforcement
- אי-מחיקה: `allow delete: if false`
- מספור: `lastNumber == resource.data.lastNumber + 1`
- audit: `actorUid == request.auth.uid`
- tenant: `userCompanyId == companyId`

> Firestore Security Rules אוכפים אי-שינוי ברמת שדה בודד, ללא תלות בשיטת הכתיבה (single write / batch write / transaction).

### 3.2 צד לקוח (UX)
- ImmutabilityGuard — מונע שליחת בקשות שיידחו
- הערבות המשפטית — Firestore Rules בלבד

## 4. הגבלות ידועות

| הגבלה | סטטוס | תוכנית |
|--------|--------|--------|
| API חשבוניות ישראל | placeholder | יוחלף ב-endpoint אמיתי לאחר רישום |
| Cloud Functions | מתוכנן | העברת לוגיקת מספור ל-trusted backend |
| External audit | טרם בוצע | מתוכנן לפני השקה |
| Penetration testing | טרם בוצע | מתוכנן לפני השקה |

## 5. חתימה

| פרט | ערך |
|------|------|
| תאריך | פברואר 2026 |
| גרסה | 1.0 |
| סטטוס | טרום-רישום |
