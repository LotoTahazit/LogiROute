# תוכנית התאוששות מאסון — Disaster Recovery Plan

## 1. מטרות

| מדד | יעד |
|------|------|
| RTO (Recovery Time Objective) | < 4 שעות |
| RPO (Recovery Point Objective) | < 1 שעה |
| זמינות שנתית | 99.9% |

## 2. תרחישי אסון

### 2.1 P1 — אובדן בסיס נתונים
| פרט | ערך |
|------|------|
| סבירות | נמוכה מאוד (Firestore multi-region) |
| השפעה | קריטית — אין גישה לנתונים |
| שחזור | PITR / quarterly backup |
| RTO | 2-4 שעות |

**צעדי שחזור:**
1. זיהוי התקלה (monitoring alerts)
2. הערכת היקף (אילו נתונים נפגעו)
3. בחירת נקודת שחזור (PITR או backup אחרון)
4. ביצוע שחזור מ-Firestore PITR
5. אימות שלמות: `verifyChain()` + `verifySequentialIntegrity()`
6. אימות עוגנים: `verifyAnchor()` על עוגן אחרון
7. בדיקת דגימה ידנית (10 מסמכים אקראיים)
8. חזרה לפעילות
9. Post-mortem תוך 48 שעות

### 2.2 P2 — תקלת Firebase Auth
| פרט | ערך |
|------|------|
| סבירות | נמוכה (Google SLA 99.95%) |
| השפעה | גבוהה — אין כניסה למערכת |
| שחזור | המתנה ל-Google + cache מקומי |
| RTO | 1-2 שעות |

**צעדי שחזור:**
1. בדיקת סטטוס Firebase (status.firebase.google.com)
2. הודעה ללקוחות
3. המתנה לשחזור Google
4. אימות פעילות
5. עדכון לקוחות

### 2.3 P3 — תקלת API חשבוניות ישראל
| פרט | ערך |
|------|------|
| סבירות | בינונית |
| השפעה | בינונית — לא ניתן להדפיס מקור מעל הסף |
| שחזור | retry אוטומטי + manual retry |
| RTO | תלוי ברשות המסים |

**צעדי שחזור:**
1. Retry אוטומטי (3 ניסיונות, exponential backoff)
2. סטטוס error — רישום ביומן
3. Manual retry זמין למשתמש
4. הדפסת עותקים מותרת (לא מקור)
5. לאחר שחזור API — retry לכל הממתינים

### 2.4 P4 — Data breach / חדירה
| פרט | ערך |
|------|------|
| סבירות | נמוכה (Rules + Auth) |
| השפעה | קריטית — חשיפת נתונים |
| שחזור | incident response plan |

**צעדי שחזור:**
1. זיהוי (audit log / access log anomalies)
2. בלימה (disable compromised accounts)
3. הערכת נזק (אילו נתונים נחשפו)
4. הודעה לנפגעים (GDPR / חוק הגנת הפרטיות)
5. תיקון (patch vulnerability)
6. Post-mortem + lessons learned

## 3. גיבויים

| סוג | תדירות | מיקום | retention |
|------|---------|-------|-----------|
| Firestore Automatic | יומי | me-west1 | 7 ימים |
| PITR | רציף | me-west1 | 7 ימים |
| Compliance Backup | רבעוני | GCS me-west1 | 7 שנים |

## 4. בדיקות שחזור

| פרט | ערך |
|------|------|
| תדירות | פעם ברבעון |
| תיעוד | `companies/{cId}/restore_tests/{testId}` |
| כולל | הצלחה/כישלון, מספר מסמכים, משך שחזור |
| אימות | verifyChain + verifySequentialIntegrity + anchor verification |

## 5. אנשי קשר

| תפקיד | אחריות |
|--------|---------|
| מנהל מערכת | הפעלת תוכנית DR, תקשורת עם לקוחות |
| מפתח ראשי | שחזור טכני, אימות שלמות |
| רואה חשבון | אישור שלמות נתונים לאחר שחזור |

## 6. תרגול

- תרגיל DR מלא: פעם בשנה
- בדיקת שחזור: פעם ברבעון
- סקירת תוכנית: פעם בשנה או לאחר אירוע

---

**תאריך**: פברואר 2026
**גרסה**: 1.0
