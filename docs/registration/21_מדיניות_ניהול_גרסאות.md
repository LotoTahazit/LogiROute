# מדיניות ניהול גרסאות — Version Control Policy

## 1. עקרונות

- כל שינוי בקוד מתועד ב-Git
- כל גרסה מקבלת מספר ייחודי (Semantic Versioning)
- שינויים ב-Firestore Rules — דורשים review ותיעוד
- שינויים בתבניות הדפסה — נרשמים ב-print_templates

## 2. מספור גרסאות (Semantic Versioning)

```
MAJOR.MINOR.PATCH
```

| רכיב | מתי משתנה | דוגמה |
|-------|-----------|--------|
| MAJOR | שינוי שובר תאימות | 1.0.0 → 2.0.0 |
| MINOR | פיצ'ר חדש (תואם) | 1.0.0 → 1.1.0 |
| PATCH | תיקון באג | 1.0.0 → 1.0.1 |

## 3. ניהול קוד (Git)

| פרט | ערך |
|------|------|
| Repository | Git (GitHub/GitLab) |
| Branch strategy | main + feature branches |
| Main branch | protected — merge only |
| Code review | נדרש לפני merge |
| CI/CD | automated build + deploy |

### 3.1 תהליך שינוי
1. יצירת feature branch
2. פיתוח + בדיקות
3. Pull Request + code review
4. Merge ל-main
5. Deploy (manual / automated)
6. תיעוד ב-CHANGELOG

## 4. Firestore Security Rules

| פרט | ערך |
|------|------|
| קובץ | `firestore.rules` |
| ניהול | Git (כמו קוד) |
| Deploy | `firebase deploy --only firestore:rules` |
| Review | חובה לפני deploy |
| Rollback | Git revert + redeploy |

### 4.1 שינויים קריטיים (דורשים review מורחב)
- שינוי ב-protected fields whitelist
- שינוי ב-delete rules
- שינוי ב-audit log rules
- שינוי ב-counter increment rules
- שינוי ב-tenant isolation rules

## 5. תבניות הדפסה

| פרט | ערך |
|------|------|
| אוסף | `companies/{cId}/print_templates/{tId}` |
| גרסה | `PrintTemplateRegistry.currentVersion` |
| כל הדפסה | כוללת `templateVersion` |
| שחזור | ניתן לשחזר תבנית לפי גרסה |

## 6. CHANGELOG

כל גרסה מתועדת ב-`CHANGELOG.md`:
- תאריך
- מספר גרסה
- שינויים (features, fixes, breaking changes)
- שינויי compliance (אם רלוונטי)

## 7. גיבוי גרסאות

- Git history — כל השינויים שמורים
- Tags — כל release מקבל tag
- Firestore Rules — גרסה נוכחית + היסטוריה ב-Git

---

**תאריך**: פברואר 2026
**גרסה**: 1.0
