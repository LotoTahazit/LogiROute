# üì¶ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Nested Collections

## –û–±–∑–æ—Ä

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ LogiRoute –º–∏–≥—Ä–∏—Ä–æ–≤–∞–ª–æ –Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É nested collections –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–æ–º–ø–∞–Ω–∏—è–º–∏.

**–°—Ç–∞—Ä–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
/box_types/{id} (—Å –ø–æ–ª–µ–º companyId)
/clients/{id} (—Å –ø–æ–ª–µ–º companyId)
/delivery_points/{id} (—Å –ø–æ–ª–µ–º companyId)
/invoices/{id} (—Å –ø–æ–ª–µ–º companyId)
/prices/{id} (—Å –ø–æ–ª–µ–º companyId)
/inventory/{id} (—Å –ø–æ–ª–µ–º companyId)
```

**–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
/companies/{companyId}/box_types/{id}
/companies/{companyId}/clients/{id}
/companies/{companyId}/delivery_points/{id}
/companies/{companyId}/invoices/{id}
/companies/{companyId}/prices/{id}
/companies/{companyId}/inventory/{id}
```

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–ª—É—á–∞–π–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –¥—Ä—É–≥–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ó–∞–ø—Ä–æ—Å—ã –±—ã—Å—Ç—Ä–µ–µ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ companyId
3. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –ø—Ä–∞–≤–∏–ª:** Security Rules –ø—Ä–æ—â–µ –∏ –Ω–∞–¥–µ–∂–Ω–µ–µ
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –õ–µ–≥–∫–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å/–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

### –ß–µ—Ä–µ–∑ UI (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É "Nested Collections Migration" (–¥–µ—Ä–µ–≤–æ) –≤ –≤–µ—Ä—Ö–Ω–µ–º –º–µ–Ω—é
4. –ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é"
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ
6. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç)

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

1. –°–∫—Ä–∏–ø—Ç –Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –∫–æ–º–ø–∞–Ω–∏–∏ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `/companies`
2. –î–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–ø–∞–Ω–∏–∏:
   - –ß–∏—Ç–∞–µ—Ç –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑ —Å—Ç–∞—Ä–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å `companyId` —ç—Ç–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
   - –ö–æ–ø–∏—Ä—É–µ—Ç –∏—Ö –≤ –Ω–æ–≤—É—é –≤–ª–æ–∂–µ–Ω–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é `companies/{companyId}/collection`
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –ø–æ–ª—è –≤–∫–ª—é—á–∞—è `companyId` (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
3. –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ù–ï —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ü–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π

- ‚úÖ –°–¥–µ–ª–∞–π—Ç–µ backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –µ—Å—Ç—å –ø–æ–ª–µ `companyId`
- ‚úÖ –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –µ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –≤ Firestore

### –í–æ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏

- ‚è≥ –ù–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä
- ‚è≥ –ù–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
- ‚è≥ –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —ç–∫—Ä–∞–Ω–µ –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚è≥ –ü—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 5-15 –º–∏–Ω—É—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

- ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
- ‚úÖ –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –í Firebase Console

1. –û—Ç–∫—Ä–æ–π—Ç–µ Firestore Database
2. –ù–∞–π–¥–∏—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é `companies`
3. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏
4. –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ø–æ–¥–∫–æ–ª–ª–µ–∫—Ü–∏–∏:
   - `box_types`
   - `clients`
   - `delivery_points`
   - `invoices`
   - `prices`
   - `inventory`

### –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π box_type
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
3. –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ—á–∫—É –¥–æ—Å—Ç–∞–≤–∫–∏
4. –°–æ–∑–¥–∞–π—Ç–µ —Å—á–µ—Ç
5. –í—Å–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ Firebase Console:

```javascript
// –°—Ç–∞—Ä–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è
db.collection('box_types').where('companyId', '==', 'YOUR_COMPANY_ID').count()

// –ù–æ–≤–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è
db.collection('companies').doc('YOUR_COMPANY_ID').collection('box_types').count()

// –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å!
```

---

## üîß –†—É—á–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞, –º–æ–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Firebase Console:

### –î–ª—è –æ–¥–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ Firebase Console
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Firestore
3. –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä `box_types`)
4. –û—Ç—Ñ–∏–ª—å—Ç—Ä—É–π—Ç–µ –ø–æ `companyId == YOUR_COMPANY_ID`
5. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ
6. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ `companies/YOUR_COMPANY_ID/box_types`

### –ß–µ—Ä–µ–∑ Cloud Functions

–°–æ–∑–¥–∞–π—Ç–µ Cloud Function –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏:

```javascript
const admin = require('firebase-admin');
admin.initializeApp();
const db = admin.firestore();

exports.migrateCollection = functions.https.onRequest(async (req, res) => {
  const collectionName = req.query.collection;
  const companyId = req.query.companyId;
  
  const oldDocs = await db.collection(collectionName)
    .where('companyId', '==', companyId)
    .get();
  
  const batch = db.batch();
  
  oldDocs.forEach(doc => {
    const newRef = db.collection('companies')
      .doc(companyId)
      .collection(collectionName)
      .doc(doc.id);
    
    batch.set(newRef, doc.data());
  });
  
  await batch.commit();
  
  res.send(`Migrated ${oldDocs.size} documents`);
});
```

---

## üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–í–ê–ñ–ù–û:** –£–¥–∞–ª—è–π—Ç–µ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏!

### –ß–µ—Ä–µ–∑ UI

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. –û—Ç–∫—Ä–æ–π—Ç–µ Firebase Console
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Firestore
3. –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ä—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä `/box_types`)
4. –£–¥–∞–ª–∏—Ç–µ –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å –≤–∞—à–∏–º `companyId`

### –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç

```javascript
// –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ–¥–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
const companyId = 'YOUR_COMPANY_ID';
const collections = ['box_types', 'clients', 'delivery_points', 'invoices', 'prices', 'inventory'];

for (const collection of collections) {
  const snapshot = await db.collection(collection)
    .where('companyId', '==', companyId)
    .get();
  
  const batch = db.batch();
  snapshot.docs.forEach(doc => batch.delete(doc.ref));
  await batch.commit();
  
  console.log(`Deleted ${snapshot.size} documents from ${collection}`);
}
```

---

## üÜò –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup

1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∞–∑—É –∏–∑ backup
3. –û—Ç–∫–∞—Ç–∏—Ç–µ –∫–æ–¥ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 2: –£–¥–∞–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

1. –£–¥–∞–ª–∏—Ç–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–∑ `companies/{companyId}/`
2. –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º–∏
3. –û—Ç–∫–∞—Ç–∏—Ç–µ –∫–æ–¥ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ —ç–∫—Ä–∞–Ω–µ –º–∏–≥—Ä–∞—Ü–∏–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Firebase Console
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Security Rules
4. –°–≤—è–∂–∏—Ç–µ—Å—å —Å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

- [ ] –°–¥–µ–ª–∞–Ω backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- [ ] –ó–∞–ø—É—â–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ UI
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
- [ ] –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 23.02.2026
**–í–µ—Ä—Å–∏—è:** 1.0
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
