# 🔄 Рабочие процессы (Workflows)

## 1. Процесс создания и выполнения доставки

### Шаг 1: Диспетчер создает точки доставки

```
┌─────────────────────────────────────────┐
│  Диспетчер открывает вкладку            │
│  "Точки доставки"                       │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Нажимает кнопку "+"                    │
│  (Добавить точку доставки)              │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Заполняет форму:                       │
│  • Имя клиента                          │
│  • Адрес (с автодополнением)            │
│  • Количество паллет                    │
│  • Срочность (обычная/срочная)          │
│  • Контактная информация                │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Система:                               │
│  • Геокодирует адрес                    │
│  • Сохраняет в Firestore                │
│  • Статус: "pending"                    │
└─────────────────────────────────────────┘
```

### Скриншоты для презентации:
```
📸 НУЖНЫ СКРИНШОТЫ:
1. Вкладка "Точки доставки" с кнопкой "+"
2. Диалог создания точки (пустая форма)
3. Диалог создания точки (заполненная форма)
4. Автодополнение адреса
5. Список точек со статусом "pending"
```

---

### Шаг 2: Автоматическое распределение

```
┌─────────────────────────────────────────┐
│  Диспетчер нажимает                     │
│  "Автоматическое распределение"         │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Система анализирует:                   │
│  • Доступных водителей                  │
│  • Вместимость каждого водителя         │
│  • Количество паллет в точках           │
│  • Географическое расположение          │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Алгоритм распределения:                │
│  1. Сортирует точки по срочности        │
│  2. Группирует по географии             │
│  3. Назначает водителям                 │
│  4. Оптимизирует маршруты               │
│  5. Рассчитывает ETA                    │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Результат:                             │
│  • Точки назначены водителям            │
│  • Создан routeId для каждого водителя  │
│  • Рассчитан orderInRoute               │
│  • Статус изменен на "assigned"         │
└─────────────────────────────────────────┘
```

### Скриншоты для презентации:
```
📸 НУЖНЫ СКРИНШОТЫ:
1. Кнопка "Автоматическое распределение"
2. Индикатор загрузки во время распределения
3. Уведомление об успешном распределении
4. Вкладка "Маршруты" после распределения
```

---

### Шаг 3: Диспетчер проверяет маршруты

```
┌─────────────────────────────────────────┐
│  Диспетчер открывает вкладку            │
│  "Маршруты"                             │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Видит маршруты, сгруппированные        │
│  по водителям:                          │
│                                         │
│  🚗 Водитель 1 (12/15 паллет)          │
│    1. Клиент А - 3 паллеты             │
│    2. Клиент Б - 5 паллет              │
│    3. Клиент В - 4 паллеты             │
│                                         │
│  🚗 Водитель 2 (8/20 паллет)           │
│    1. Клиент Г - 8 паллет              │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Может:                                 │
│  • Изменить порядок (Drag & Drop)       │
│  • Изменить водителя                    │
│  • Отменить маршрут                     │
│  • Печать маршрута                      │
│  • Создать счет                         │
└─────────────────────────────────────────┘
```

### Скриншоты для презентации:
```
📸 НУЖНЫ СКРИНШОТЫ:
1. Вкладка "Маршруты" с группировкой
2. Drag & Drop точки в маршруте
3. Меню действий для маршрута
4. Диалог изменения водителя
5. Диалог подтверждения отмены маршрута
```

---

### Шаг 4: Диспетчер просматривает на карте

```
┌─────────────────────────────────────────┐
│  Диспетчер открывает вкладку "Карта"    │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Видит:                                 │
│  • 🏭 Маркер склада (начальная точка)   │
│  • 📍 Все точки доставки с номерами     │
│  • 🛣️ Маршруты разных цветов           │
│  • 🚗 Позиции водителей (real-time)     │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Может:                                 │
│  • Фильтровать по водителям             │
│  • Увеличивать/уменьшать карту          │
│  • Кликать на маркеры для деталей       │
└─────────────────────────────────────────┘
```

### Цветовое кодирование маршрутов:
- 🔵 **Синий** - Водитель 1
- 🟢 **Зеленый** - Водитель 2
- 🔴 **Красный** - Водитель 3
- 🟡 **Желтый** - Водитель 4
- 🟣 **Фиолетовый** - Водитель 5
- ⚫ **Серый** - Пройденные участки

### Скриншоты для презентации:
```
📸 НУЖНЫ СКРИНШОТЫ:
1. Карта со всеми маршрутами
2. Маркер склада (🏭)
3. Маркеры точек доставки с номерами
4. Маршруты разных цветов
5. Позиции водителей (🚗)
6. Фильтр по водителям
7. Легенда с цветами
8. Popup с деталями точки
```

---

### Шаг 5: Водитель получает маршрут

```
┌─────────────────────────────────────────┐
│  Водитель входит в приложение           │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Видит:                                 │
│  • Список назначенных точек             │
│  • Порядок доставки (1, 2, 3...)        │
│  • Адреса и ETA                         │
│  • Карту с маршрутом                    │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Нажимает большую кнопку                │
│  "НАЧАТЬ НАВИГАЦИЮ"                     │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Открывается Google Maps с:             │
│  • Начальной точкой (склад)             │
│  • Всеми промежуточными точками         │
│  • Конечной точкой                      │
│  • Пошаговой навигацией                 │
└─────────────────────────────────────────┘
```

### Скриншоты для презентации:
```
📸 НУЖНЫ СКРИНШОТЫ:
1. Экран водителя со списком точек
2. Большая кнопка "НАЧАТЬ НАВИГАЦИЮ"
3. Карта с маршрутом водителя
4. Google Maps с полным маршрутом
5. Пошаговая навигация в Google Maps
```

---

### Шаг 6: GPS-трекинг водителя

```
┌─────────────────────────────────────────┐
│  08:00 - Начало рабочего дня            │
│  Автоматически запускается GPS-трекинг  │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Каждые 30 секунд:                      │
│  • Получение GPS-координат              │
│  • Обновление в Firestore               │
│  • Проверка близости к точкам           │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Диспетчер видит на карте:              │
│  • 🚗 Позицию водителя (real-time)      │
│  • Движение по маршруту                 │
│  • Прогресс выполнения                  │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  18:00 - Конец рабочего дня             │
│  Автоматически останавливается трекинг  │
└─────────────────────────────────────────┘
```

### Скриншоты для презентации:
```
📸 НУЖНЫ СКРИНШОТЫ:
1. Индикатор GPS-трекинга (активен)
2. Позиция водителя на карте диспетчера
3. Уведомление о начале трекинга
4. Уведомление о конце трекинга
```

---

### Шаг 7: Выполнение доставки

```
┌─────────────────────────────────────────┐
│  Водитель приближается к точке          │
│  (в радиусе 100 метров)                 │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Автоматическое завершение:             │
│  • Система обнаруживает близость        │
│  • Статус меняется на "completed"       │
│  • Показывается уведомление             │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  ИЛИ Ручное завершение:                 │
│  • Водитель нажимает "Выполнено"        │
│  • Статус меняется на "completed"       │
│  • Переход к следующей точке            │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Обновление UI:                         │
│  • ✅ Зеленая галочка на точке          │
│  • Следующая точка становится активной  │
│  • Обновление прогресса на карте        │
└─────────────────────────────────────────┘
```

### Скриншоты для презентации:
```
📸 НУЖНЫ СКРИНШОТЫ:
1. Точка доставки с кнопкой "Выполнено"
2. Уведомление об автоматическом завершении
3. Выполненная точка с зеленой галочкой
4. Прогресс на карте (серые пройденные участки)
```

---

### Шаг 8: Завершение маршрута

```
┌─────────────────────────────────────────┐
│  Все точки выполнены                    │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Водитель видит:                        │
│  • Все точки с зелеными галочками       │
│  • Сообщение "Маршрут завершен"         │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Диспетчер видит:                       │
│  • Маршрут исчезает из активных         │
│  • Статистика выполнения                │
│  • Возможность создать новый маршрут    │
└─────────────────────────────────────────┘
```

### Скриншоты для презентации:
```
📸 НУЖНЫ СКРИНШОТЫ:
1. Все точки выполнены (зеленые галочки)
2. Сообщение о завершении маршрута
3. Пустой список активных маршрутов у диспетчера
```

---

## 2. Процесс создания счета (חשבונית)

```
┌─────────────────────────────────────────┐
│  Диспетчер выбирает точку доставки      │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Нажимает "Создать счет"                │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Открывается диалог создания счета:     │
│  • Номер счета (автоматический)         │
│  • Данные клиента (из точки)            │
│  • Список товаров                       │
│  • Цены (из базы данных)                │
│  • Общая сумма (автоматический расчет)  │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Диспетчер:                             │
│  • Добавляет товары                     │
│  • Указывает количество                 │
│  • Проверяет сумму                      │
│  • Нажимает "Создать"                   │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Система:                               │
│  • Сохраняет счет в Firestore           │
│  • Генерирует PDF                       │
│  • Открывает диалог печати              │
│  • Тип копии: מקור (оригинал)          │
└─────────────────────────────────────────┘
```

### Скриншоты для презентации:
```
📸 НУЖНЫ СКРИНШОТЫ:
1. Кнопка "Создать счет" на точке
2. Диалог создания счета (пустой)
3. Диалог создания счета (заполненный)
4. Выбор товаров из списка
5. Автоматический расчет суммы
6. Предпросмотр PDF счета
7. Диалог печати
```

---

## 3. Процесс управления складом

```
┌─────────────────────────────────────────┐
│  Кладовщик входит в систему             │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Видит список товаров на складе:        │
│  • Название товара                      │
│  • Текущее количество                   │
│  • Единица измерения                    │
│  • Минимальный остаток                  │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Может выполнить действия:              │
│  • ➕ Добавить товар (приход)           │
│  • ➖ Списать товар (расход)            │
│  • 📦 Управлять типами коробок          │
│  • 📊 Провести инвентаризацию           │
│  • 📈 Просмотреть отчеты                │
└─────────────────────────────────────────┘
```

### Скриншоты для презентации:
```
📸 НУЖНЫ СКРИНШОТЫ:
1. Главный экран кладовщика
2. Список товаров с остатками
3. Диалог добавления товара
4. Диалог списания товара
5. Предупреждение о низком остатке
6. Экран типов коробок
7. Экран инвентаризации
8. Отчет по изменениям
```

---

## 4. Процесс управления пользователями (Админ)

```
┌─────────────────────────────────────────┐
│  Админ входит в систему                 │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Видит список пользователей:            │
│  • Имя                                  │
│  • Email                                │
│  • Роль                                 │
│  • Компания (для Super Admin)           │
│  • Номер машины (для водителей)         │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  Может:                                 │
│  • ➕ Добавить пользователя             │
│  • ✏️ Редактировать пользователя        │
│  • 🗑️ Удалить пользователя             │
│  • 🔄 Обновить список                   │
│  • 👁️ Переключиться на роль (View As)  │
└─────────────────────────────────────────┘
```

### Скриншоты для презентации:
```
📸 НУЖНЫ СКРИНШОТЫ:
1. Список пользователей
2. Диалог создания пользователя
3. Диалог редактирования пользователя
4. Диалог удаления пользователя
5. Фильтр по компаниям (Super Admin)
6. Индикатор режима "View As"
```

---

**Следующий раздел**: [План презентации](05_PRESENTATION_PLAN.md)
